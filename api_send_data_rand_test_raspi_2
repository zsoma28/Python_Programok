import requests
import time
from pigpio_dht import DHT11

apikey = "123456789"

# Adatok kuldese a sajat php api-ra
def send_data_to_api(temperature, pressure):
    url = f'http://192.168.0.181/sensor/insert_data_apikey.php?api_key={apikey}&temperature={temperature}&pressure={pressure}'
    print(f"Kuldesi URL: {url}")
    try:
        response = requests.get(url)
        print(f"Valasz kod: {response.status_code}")
        print(f"Valasz szoveg: {response.text}")
        
        if response.status_code == 200:
            print(f"Sikeres adatkuuldes: Homerseklet={temperature}, Legnyomas={pressure}")
        else:
            print(f"Sikertelen adatkuuldes: {response.status_code}")
    except Exception as e:
        print(f"Hiba a kuldes soran: {e}")

sensor = DHT11(4)  # GPIO4 (BCM szamozas)

# Vegtelen ciklus 10 masodperces idokozonken
while True:
    result = sensor.read()
    if result['valid']:
        temperature = round(result['temp_c'], 2)
        pressure = round(result['humidity'], 2)
        print(f"{temperature:05.2f}*C {pressure:05.2f}hPa")
        
        # Adatok kuldese
        send_data_to_api(temperature, pressure)
    else:
        print("Ervenytelen szenzor olvasas")
    
    # 10 masodperces varakozas
    time.sleep(10)
