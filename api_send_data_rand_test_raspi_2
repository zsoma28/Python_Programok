import requests
import time
from pigpio_dht import DHT11

apikey = "NTLPKTK3A97LLKRE"

# Adatok küldése a saját php api-ra
def send_data_to_api(temperature, humidity):
    url = f'http://localhost/sensor/insert_data_apikey.php?api_key={apikey}&temperature={temperature}&humidity={humidity}'
    response = requests.get(url)
    
    if response.status_code == 200:
        print(f"Sikeres adatküldés: Hőmérséklet={temperature}, Páratartalom={humidity}")
    else:
        print(f"Sikertelen adatküldés: {response.status_code}")

sensor = DHT11(4)  # GPIO4 (BCM számozás)

# Végtelen ciklus 10 másodperces időközönként
while True:
    result = sensor.read()
    if result['valid']:
        temperature = round(result['temp_c'], 2)
        humidity = round(result['humidity'], 2)
        print(f"{temperature:05.2f}*C {humidity:05.2f}%")
        
        # Adatok küldése
        send_data_to_api(temperature, humidity)
    else:
        print("Érvénytelen szenzor olvasás")
    
    # 10 másodperces várakozás
    time.sleep(10)
