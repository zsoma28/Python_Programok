import requests
import time
from pigpio_dht import DHT11

apikey = "123456789"

# Adatok kuldese a sajat php api-ra
def send_data_to_api(temperature, humidity):
    url = f'http://192.168.0.181/sensor/insert_data_apikey.php?api_key={apikey}&temperature={temperature}&humidity={humidity}'
    response = requests.get(url)
    
    if response.status_code == 200:
        print(f"Sikeres adatkuuldes: Homerseklet={temperature}, Paratartalom={humidity}")
    else:
        print(f"Sikertelen adatkuuldes: {response.status_code}")

sensor = DHT11(4)  # GPIO4 (BCM szamozas)

# Vegtelen ciklus 10 masodperces idokozonken
while True:
    result = sensor.read()
    if result['valid']:
        temperature = round(result['temp_c'], 2)
        humidity = round(result['humidity'], 2)
        print(f"{temperature:05.2f}*C {humidity:05.2f}%")
        
        # Adatok kuldese
        send_data_to_api(temperature, humidity)
    else:
        print("Ervenytelen szenzor olvasas")
    
    # 10 masodperces varakozas
    time.sleep(10)
